<!DOCTYPE html>
<html>
<body>
HI!!!!!
<form name = "form_input" enctype="multipart/form-data">

  <input type="file" name="whocares" id="idexample" />
  <button type="button" onclick="doSomething()">Enter</button>
  
  </form>
  
  <div id="outputDiv"></div>
<script language="JavaScript">
function doSomething()
{
    var file = document.getElementById('idexample');
    
    if(file.files.length)
    {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (this.status == 200 && this.readyState == xhr.DONE) {
            var response = JSON.parse(this.responseText)
            var url = response.url
            var fileUUID = response.fileUUID
            uploadFile(file.files[0], url, fileUUID)
          }
        }
        xhr.open('GET', 'http://34.140.9.12/api/minizinc/upload')
        xhr.send()
        /*
        var reader = new FileReader();
        
        reader.onload = function(e)
        {
            document.getElementById('outputDiv').innerHTML = e.target.result;
        };
        
        reader.readAsBinaryString(file.files[0]);*/
    }
}
function uploadFile(file, url, fileUUID) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function () {
    if (this.status == 200 && this.readyState == xhr.DONE) {
      console.log("File PUT!")
      persistFileUpload("kenny-test", file.name, fileUUID)
    }
  }
  xhr.open('PUT', url)
  xhr.send(file)
}

function persistFileUpload(userID, fileName, fileUUID) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function () {
    if (this.status == 200 && this.readyState == xhr.DONE) {
      console.log("File persisted!")
    }
  }
  xhr.open('POST', 'http://34.140.9.12/api/minizinc/upload')
  xhr.setRequestHeader('Content-Type', 'application/json')
  xhr.send(JSON.stringify({
    "userID": userID,
    "fileName": fileName,
    "fileUUID": fileUUID
  }))
}

</script>

</body>
</html>